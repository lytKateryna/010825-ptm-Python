## Что такое файл?

**Файл** — это определённый набор байтов (то есть набор 0 и 1).

Различают
* **Текстовые** файлы и
* **Бинарные** файлы

Но если и те, и другие — это набор байтов, то в чём разница?


## Функция `open()`

Функция `open()` в Python **открывает файл** и возвращает **объект файла**, через который можно:

* читать данные
* записывать данные
* добавлять данные
* перемещаться по файлу

---

## Синтаксис

```
file = open(filename, mode, encoding)
```

### Основные аргументы:

| Аргумент   | Значение                                  | Пример                             |
| ---------- |-------------------------------------------| ---------------------------------- |
| `file`     | Путь к файлу <br>(как минимум, имя файла) | `"data.txt"`                       |
| `mode`     | Режим работы                              | `"r"`, `"w"`, `"a"`, `"rb"` и т.п. |
| `encoding` | Кодировка текста                          | `"utf-8"`, `"cp1251"`              |

---

## Режимы открытия файла (`mode`)

| Режим  | Значение         | Что делает                            | Если файла нет               |
| ------ | ---------------- | ------------------------------------- | ---------------------------- |
| `"r"`  | read             | читать файл                           | ошибка                       |
| `"w"`  | write            | записать заново (стирает содержимое!) | создаст файл                 |
| `"a"`  | append           | дописать в конец                      | создаст файл                 |
| `"x"`  | exclusive create | создать новый файл                    | ошибка, если файл существует |
| `"rb"` | read binary      | читать в бинарном виде                | ошибка                       |
| `"wb"` | write binary     | записать в бинарном виде              | создаст файл                 |
| `"ab"` | append binary    | дописать в бинарном виде              | создаст файл                 |

**Текст vs бинарный режим**

* Текстовый (`"r"`, `"w"`, `"a"`) — данные интерпретируются как **строки**
* Бинарный (`"rb"`, `"wb"`, `"ab"`) — данные читаются как **байты**

---

## Пример открытия файла

```python
f = open("data.txt", "r", encoding="utf-8")

print(type(f))  # <class '_io.TextIOWrapper'>
text = f.read()
f.close()

print(text)
```

Но **так делать нежелательно** — можно забыть `close()`.  
Для Linux незакрытый файл можно пережить, но для Windows — это уже катастрофа!

---

## Context Manager 

Контекстный менеджер — это удобный способ работы с файлами.

Контекстный менеджер автоматически закрывает файл, как только программа выходит из его блока.

```python
with open("data.txt", "r", encoding="utf-8") as file:
    text = file.read()

print(text)
```

### Работа с несколькими контекстными менеджерами

```python

# ----------- Вариант 1 -----------  
with (open("file_in", "r", encoding="utf-8") as f_in, 
      open("file_out", "w", encoding="utf-8") as f_out):
    
    # Перезаписываем файл в верхнем регистре
    f_out.write(f_in.read().upper())  

    
# ----------- Вариант 2 -----------  
with open("example.txt", "r", encoding="utf-8") as f_in:
    with open("output.txt", "w", encoding="utf-8") as f_out:
        
        # Перезаписываем файл в верхнем регистре
        f_out.write(f_in.read().upper())  
```

---

## Методы работы с объектом f (объект файла или файловый поток)

Объект файла возвращается функцией `open()`.  

Вот его методы:

| Метод                | Что делает                             | Возвращает                     | Пример                        |
| -------------------- | -------------------------------------- | ------------------------------ | ----------------------------- |
| `f.read()`           | Читает весь файл целиком               | строку или байты               | `text = f.read()`             |
| `f.read(n)`          | Читает **n** символов/байтов           | строку/байты длины `n`         | `part = f.read(10)`           |
| `f.readline()`       | Читает **одну строку**                 | строку                         | `line = f.readline()`         |
| `f.readlines()`      | Читает **все строки в список**         | список строк                   | `lines = f.readlines()`       |
| `for line in f:`     | Перебирает файл **строка за строкой**  | итератор                       | `for line in f: print(line)`  |
| `f.write(s)`         | Записывает строку/байты `s`            | количество записанных символов | `f.write("Hello\n")`          |
| `f.writelines(list)` | Записывает **список строк**            | `None`                         | `f.writelines(["a\n","b\n"])` |
| `f.seek(offset)`     | Перемещает указатель чтения/записи     | позицию                        | `f.seek(0)` — в начало        |
| `f.tell()`           | Возвращает текущую позицию указателя   | число (байты)                  | `pos = f.tell()`              |
| `f.flush()`          | Принудительно сбрасывает буфер на диск | `None`                         | `f.flush()`                   |
| `f.close()`          | Закрывает файл                         | `None`                         | `f.close()`                   |



---
## Примеры

### Чтение текстового файла построчно

```python
with open("data.txt", "r", encoding="utf-8") as file:
    for line in file:
        print(line)
```

Или:

```python
lines = file.readlines()  # список строк
```

---

### Запись в файл (перезапись, если файл не пустой!)

```python
with open("data.txt", "w", encoding="utf-8") as file:
    file.write("Hello!\n")
```

---

### Дозапись (добавление данных в файл "снизу")

```python
with open("data.txt", "a", encoding="utf-8") as file:
    file.write("Добавляем строку\n")
```

---

### Чтение бинарного файла (пример)

Чтение изображения:

```python
with open("image.jpg", "rb") as file:
    data = file.read()
```

---

## Итог

* `open()` создаёт **объект файла**
* `mode` определяет **как** работать с файлом (читать/писать/дописывать)
* Для текстов используем `encoding`
* Всегда лучше использовать `with`, чтобы **не забывать закрывать файл**

